<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Danh sách thiết bị điện tử</title>
<link rel="stylesheet" href="quanly.css">
</head>
<body>
<div class="container">
<div class="header-bar">
    <h2>Danh sách thiết bị điện tử</h2>
    <div class="user-info">
        <span class="username">Xin chào</span>
        <a href="menu.html" class="btn-back">← Về menu</a>
        <button class="btn-logout" onclick="handleLogout()">Đăng xuất</button>
    </div>
</div>

<div class="toolbar">
    <input type="text" id="searchBar" class="search-bar" placeholder="Tìm kiếm thiết bị, loại, hãng..." oninput="filterTable()">
</div>

<table id="deviceTable">
    <tr>
        <th>Tên thiết bị</th>
        <th>Loại</th>
        <th>Hãng</th>
        <th>Giá (VNĐ)</th>
        <th>Tình trạng</th>
    </tr>
</table>
</div>

<script src="auth.js"></script>
<script src="devices.js"></script>
<script>
// Kiểm tra đăng nhập - nếu admin thì chuyển sang admin
const user = requireAuth(false);

// Tải danh sách thiết bị
document.addEventListener('DOMContentLoaded', function() {
    const devices = getDevices();
    const table = document.getElementById("deviceTable");
    devices.forEach(d => {
        const row = table.insertRow();
        row.insertCell(0).innerText = d.name;
        row.insertCell(1).innerText = d.type;
        row.insertCell(2).innerText = d.brand;
        row.insertCell(3).innerText = formatPrice(d.price);
        row.insertCell(4).innerText = d.status;
    });
});
if (user) {
    document.querySelector('.username').textContent = 'Xin chào, ' + user.username;
    if (user.isAdmin) {
        window.location.href = 'admin.html';
    }
}

function handleLogout() {
    logout();
    window.location.href = 'dangnhap.html';
}

function filterTable() {
    let query = document.getElementById("searchBar").value.toLowerCase().trim();
    let table = document.getElementById("deviceTable");
    let rows = table.getElementsByTagName("tr");

    for (let i = 1; i < rows.length; i++) {
        let row = rows[i];
        let cells = row.getElementsByTagName("td");
        let found = false;
        for (let j = 0; j < cells.length; j++) {
            if (cells[j].innerText.toLowerCase().includes(query)) {
                found = true;
                break;
            }
        }
        row.style.display = found || !query ? "" : "none";
    }
}
</script>
</body>
</html>
